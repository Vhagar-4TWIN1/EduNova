import{r as i,a as f,j as r,b as e,cw as Z,u as ee,cx as O,l as U}from"./index-C3nL3Q8Y.js";import{u as te}from"./useTranslation-CuP_5ynG.js";const oe=({moduleId:g,lessonId:b})=>{const[p,I]=i.useState(null),[l,k]=i.useState(!1),[y,z]=i.useState(!1),[u,v]=i.useState([]),[d,S]=i.useState(null);i.useEffect(()=>{console.log("Current states:",{sessionId:p,showPrompt:l,showSupplementary:y,supplementaryLessons:u,error:d})},[p,l,y,u,d]),i.useEffect(()=>{let s;return(async()=>{var c;try{console.log("Starting session for module:",g,"lesson:",b);const a=await f.post(`http://localhost:3000/api/study/start/${g}/${b}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});console.log("Session started:",a.data),I(a.data.sessionId),s=setTimeout(()=>{console.log("Timer expired - showing prompt"),k(!0)},5e3)}catch(a){console.error("Error starting session:",{message:a.message,response:(c=a.response)==null?void 0:c.data}),S(a)}})(),()=>{clearTimeout(s),p&&(console.log("Cleaning up - ending session"),f.post(`http://localhost:3000/api/study/end/${p}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}}).catch(c=>console.error("Error ending session:",c)))}},[g,b]);const w=async()=>{var s,C,c;try{console.log("Fetching supplementary lessons for module:",g);const a=await f.get(`http://localhost:3000/api/study/recommendations/${g}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(console.log("Received supplementary lessons:",a.data),(s=a.data)!=null&&s.lessons)v(a.data.lessons),z(!0);else throw new Error("Invalid response format - missing lessons array")}catch(a){console.error("Error fetching supplementary lessons:",{message:a.message,status:(C=a.response)==null?void 0:C.status,data:(c=a.response)==null?void 0:c.data}),S(a),z(!0)}},h=s=>{k(!1),s&&w()};return d?r("div",{style:{padding:"10px",backgroundColor:"#ffebee",border:"1px solid #ef9a9a",borderRadius:"4px",margin:"10px 0"},children:["Error: ",d.message]}):r("div",{children:[r("div",{style:{position:"fixed",bottom:"10px",right:"10px",backgroundColor:"rgba(0,0,0,0.7)",color:"white",padding:"5px 10px",borderRadius:"4px",fontSize:"12px",zIndex:1e3},children:["Session Tracker: ",p?"Active":"Inactive"]}),l&&r("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0,0,0,0.15)",zIndex:1001,width:"90%",maxWidth:"400px"},children:[e("h3",{style:{marginTop:0},children:"More Learning Resources Available"}),e("p",{children:"Would you like to see additional materials for this topic?"}),r("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[e("button",{onClick:()=>h(!0),style:{flex:1,padding:"10px",backgroundColor:"#4caf50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Yes Please"}),e("button",{onClick:()=>h(!1),style:{flex:1,padding:"10px",backgroundColor:"#f44336",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"No Thanks"})]})]}),y&&r("div",{style:{margin:"20px 0",padding:"20px",backgroundColor:"#f5f5f5",borderRadius:"8px",borderLeft:"4px solid #3f51b5"},children:[e("h3",{style:{marginTop:0},children:"Additional Resources"}),u.length>0?e("div",{style:{display:"grid",gap:"15px"},children:u.map(s=>r("div",{style:{padding:"15px",backgroundColor:"white",borderRadius:"6px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[e("h4",{style:{marginTop:0},children:s.title}),e("p",{children:s.content}),s.resourceUrl&&e("a",{href:s.resourceUrl,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",marginTop:"10px",color:"#3f51b5",fontWeight:"bold"},children:"Open Resource"})]},s._id))}):e("p",{style:{color:"#666",fontStyle:"italic"},children:"No additional resources available at this time."})]})]})},re=({lessonId:g,selectedLang:b,speakText:p,stopSpeech:I,fileUrl:l})=>{const[k,y]=i.useState([]),[z,u]=i.useState(!0);return i.useEffect(()=>{(async()=>{if(!(!g||!l))try{u(!0),y([]);const d=`/api/subtitles/${g}/${b}?url=${encodeURIComponent(l)}`,S=await fetch(d),w=S.headers.get("content-type");if(!w||!w.includes("application/json"))throw new Error("Unexpected response format");const h=await S.json(),s=b==="en"?h.transcript:h.translated;y(s.split(/\r?\n/).filter(Boolean)),u(!1)}catch(d){console.error("âŒ Failed to fetch subtitles:",d),y(["âš ï¸ Error fetching subtitles."]),u(!1)}})()},[g,b,l]),r("div",{style:{marginTop:"1rem"},children:[e("strong",{children:"ðŸŽ¬ Translated Subtitles:"}),e("div",{style:{background:"#eef2ff",padding:"1rem",borderRadius:"0.5rem",fontSize:"1rem",color:"#1e40af",maxHeight:"200px",overflowY:"auto"},children:z?e("p",{children:"â³ Translating..."}):k.map((v,d)=>e("p",{children:v},d))}),r("div",{style:{marginTop:"0.75rem"},children:[e("button",{onClick:()=>p(k.join(" ")),style:{backgroundColor:"#3b82f6",color:"white",padding:"0.6rem 1.2rem",borderRadius:"0.5rem",fontSize:"1rem",border:"none",cursor:"pointer",marginRight:"1rem"},children:"ðŸ”Š Read Aloud"}),e("button",{onClick:I,style:{backgroundColor:"#ef4444",color:"white",padding:"0.6rem 1.2rem",borderRadius:"0.5rem",fontSize:"1rem",border:"none",cursor:"pointer"},children:"ðŸ›‘ Stop"})]})]})},ne={fr:"fr-FR",de:"de-DE",es:"es-ES",it:"it-IT",ar:"ar-SA",en:"en-US"},ce=()=>{const g=Z(),b=ee(),{t:p,i18n:I}=te(),[l,k]=i.useState(!1),[y,z]=i.useState(I.language||"en"),[u,v]=i.useState(!1),[d,S]=i.useState([]),[w,h]=i.useState(""),[s,C]=i.useState(null),[c,a]=i.useState({x:520,y:350}),[R,E]=i.useState(!1),[$,P]=i.useState({x:0,y:0}),{lesson:o,moduleId:D}=g.state||{},[ie,se]=i.useState(!1),x=localStorage.getItem("userId"),[L,ae]=i.useState(null),N=()=>v(!0),B=()=>{console.log("ðŸ›‘ Close button clicked"),v(!1),h(""),C(null)},F=t=>{E(!0),P({x:t.clientX-c.x,y:t.clientY-c.y})},H=t=>{R&&a({x:t.clientX-$.x,y:t.clientY-$.y})},Y=()=>E(!1),V=t=>{if(!window.speechSynthesis){alert("Text-to-speech is not supported in this browser.");return}const n=new SpeechSynthesisUtterance(t);n.lang=ne[y]||"en-US",n.rate=1,n.pitch=1,window.speechSynthesis.cancel(),window.speechSynthesis.speak(n)},X=()=>window.speechSynthesis.cancel();i.useEffect(()=>{const t=m=>H(m),n=()=>Y();return window.addEventListener("mousemove",t),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",n)}},[R,$]);const A=async()=>{var t,n;if(!(!o||o.typeLesson!=="pdf"||!o.fileUrl||!x))try{k(!0);const m=localStorage.getItem("token");alert("Starting resume generation process...");const J=await f.get(o.fileUrl,{responseType:"blob"}),K=new File([J.data],"source_resume.pdf",{type:"application/pdf"}),W=new FormData;W.append("userId",x),W.append("file",K);const Q=await f.post("http://localhost:3000/api/gemini/generate-resume",W,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${m}`},responseType:"blob"}),G=window.URL.createObjectURL(new Blob([Q.data])),T=document.createElement("a");T.href=G,T.setAttribute("download",`enhanced_resume_${new Date().toISOString().slice(0,10)}.pdf`),alert("Resume ready! The download will start automatically"),document.body.appendChild(T),T.click(),setTimeout(()=>{T.parentNode.removeChild(T),window.URL.revokeObjectURL(G)},100)}catch(m){console.error("âŒ Failed to generate resume:",m),alert(`Failed to generate resume: ${((n=(t=m.response)==null?void 0:t.data)==null?void 0:n.error)||m.message}`)}finally{k(!1)}};i.useEffect(()=>{(async()=>{if(!(!(o!=null&&o._id)||!x||!u))try{const n=await f.get(`/api/stickynotes/${o._id}?userId=${x}`);S(n.data)}catch(n){console.error("âŒ Failed to fetch sticky notes:",n)}})()},[u]);const M=async()=>{var n;if(!w.trim())return;if(!x||x==="undefined")return console.error("âŒ userId is missing or invalid."),alert("Login is required to add sticky notes.");const t={userId:x,content:w,position:{x:0,y:0},color:"#FFEB3B"};try{s!==null?await f.put(`/api/stickynotes/${o._id}/${s}`,t):await f.post(`/api/stickynotes/${o._id}`,t);const m=await f.get(`/api/stickynotes/${o._id}?userId=${x}`);S(m.data),h(""),C(null)}catch(m){console.error("âŒ Save note failed",((n=m.response)==null?void 0:n.data)||m.message)}},_=async t=>{try{await f.delete(`/api/stickynotes/${o._id}/${t}?userId=${x}`);const n=await f.get(`/api/stickynotes/${o._id}?userId=${x}`);S(n.data)}catch(n){console.error("Delete note failed",n)}},j=t=>{h(d[t].content),C(t)};if(!o)return r("div",{style:{padding:"6rem 2rem"},children:[e("h2",{style:{color:"#ef4444"},children:p("noLesson")}),e("button",{onClick:()=>b(`/moduleDetails/course/${D||o.moduleId||o._id}`),style:{marginTop:"1rem",padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"0.5rem",cursor:"pointer"},children:p("buttons.back")})]});const q=o.typeLesson==="video";return e("div",{style:{paddingTop:"10rem",minHeight:"100vh",backgroundColor:"#f9fafb",fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"},children:r("div",{style:{maxWidth:"800px",margin:"0 auto",backgroundColor:"#fff",borderRadius:"1rem",padding:"2.5rem",boxShadow:"0 8px 24px rgba(0,0,0,0.08)"},children:[r("h1",{style:{fontSize:"2rem",fontWeight:"bold",color:"#1f2937"},children:["ðŸ“˜ ",o.title]}),r("div",{style:{marginTop:"1rem",marginBottom:"1.5rem",textAlign:"center"},children:[r("h1",{style:{fontSize:"2rem",fontWeight:"bold",color:"#1f2937"},children:["ðŸ“˜ ",o.title]}),e("div",{style:{marginTop:"1rem",marginBottom:"1.5rem"},children:e("button",{onClick:N,style:{padding:"0.6rem 1.2rem",backgroundColor:"#3b82f6",color:"#fff",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontWeight:600},children:"ðŸ“ Open Sticky Notes"})}),r("p",{style:{margin:"1rem 0",color:"#4b5563",fontSize:"1rem"},children:[r("strong",{children:[p("type"),":"]})," ",o.typeLesson.toUpperCase()]}),u&&r("div",{style:{position:"fixed",top:`${c.y}px`,left:`${c.x}px`,backgroundColor:"#ffffff",padding:"2rem",boxShadow:"0 20px 40px rgba(0,0,0,0.15)",borderRadius:"1rem",zIndex:1e3,minWidth:"420px",maxWidth:"90vw",maxHeight:"80vh",overflowY:"auto",cursor:R?"grabbing":"default"},onMouseDown:t=>t.stopPropagation(),children:[r("div",{onMouseDown:F,style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",fontWeight:700,cursor:R?"grabbing":"grab",userSelect:"none"},children:["ðŸ“ Drag me to move",e("button",{onClick:B,style:{backgroundColor:"#ef4444",color:"#fff",padding:"0.4rem 0.8rem",borderRadius:"0.375rem",fontWeight:600,border:"none",cursor:"pointer",fontSize:"0.9rem"},title:"Close",children:"âœ–"})]}),e("h2",{style:{marginBottom:"1rem",fontSize:"1.5rem",fontWeight:700,color:"#1f2937"},children:"ðŸ—’ï¸ Your Sticky Notes"}),L&&e("div",{style:{marginTop:"2rem"},children:e(O,{file:L})}),o&&e(oe,{moduleId:o.module||o.moduleId,lessonId:o._id}),e("textarea",{value:w,onChange:t=>h(t.target.value),placeholder:"Write something here...",style:{width:"100%",minHeight:"120px",padding:"1rem",borderRadius:"0.75rem",border:"1px solid #d1d5db",fontSize:"1rem",resize:"vertical",backgroundColor:"#f9fafb"}}),e("div",{style:{textAlign:"right",marginTop:"1rem"},children:e("button",{onClick:M,style:{backgroundColor:"#22c55e",color:"#fff",padding:"0.6rem 1.2rem",borderRadius:"0.5rem",fontWeight:600,border:"none",marginRight:"0.5rem",cursor:"pointer",transition:"0.2s ease"},children:s!==null?"âœ… Update":"âž• Add Note"})}),e("ul",{style:{marginTop:"2rem",padding:0},children:d.map((t,n)=>r("li",{style:{backgroundColor:"#fef3c7",padding:"1rem",marginBottom:"1rem",borderRadius:"0.75rem",listStyle:"none",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",position:"relative"},children:[e("p",{style:{marginBottom:"0.5rem",fontSize:"1rem",color:"#374151",whiteSpace:"pre-wrap"},children:t.content}),r("small",{style:{color:"#6b7280"},children:["ðŸ•’ Updated: ",new Date(t.updatedAt).toLocaleString()]}),r("div",{style:{position:"absolute",top:"0.75rem",right:"0.75rem",display:"flex",gap:"0.5rem"},children:[e("button",{onClick:()=>j(n),style:{background:"none",border:"none",color:"#3b82f6",fontSize:"1rem",cursor:"pointer"},title:"Edit note",children:"âœï¸"}),e("button",{onClick:()=>_(n),style:{background:"none",border:"none",color:"#ef4444",fontSize:"1rem",cursor:"pointer"},title:"Delete note",children:"ðŸ—‘ï¸"})]})]},n))})]}),e("div",{style:{marginBottom:"2rem"},children:q?r(U,{children:[e("video",{controls:!0,width:"100%",crossOrigin:"anonymous",style:{borderRadius:"0.5rem"},children:e("source",{src:o.fileUrl,type:"video/mp4"})}),e(re,{lessonId:o._id||o.id,selectedLang:y,speakText:V,stopSpeech:X,fileUrl:o.fileUrl})]}):e("iframe",{src:o.fileUrl,title:"Lesson Preview",width:"100%",height:"400px",style:{border:"1px solid #ccc",borderRadius:"0.5rem"}})}),o.typeLesson==="pdf"&&e("button",{onClick:A,disabled:l,style:{padding:"0.4rem 0.8rem",backgroundColor:"#8b5cf6",color:"#fff",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontWeight:600,marginLeft:"1rem",opacity:l?.7:1,position:"relative",fontSize:"1.3rem",lineHeight:"1.4"},title:"Click to generate and save your enhanced resume",children:l?r(U,{children:[e("span",{style:{display:"inline-block",width:"0.8rem",height:"0.8rem",border:"2px solid rgba(255,255,255,0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite",marginRight:"0.3rem"}}),"Generating..."]}):"ðŸ“„ Generate Resume"}),e("button",{onClick:N,style:{padding:"0.75rem 1.5rem",background:"linear-gradient(135deg, #4fa54f, #3b82f6)",color:"#fff",border:"none",borderRadius:"12px",cursor:"pointer",fontWeight:600,fontSize:"1rem",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease"},onMouseOver:t=>t.currentTarget.style.transform="scale(1.3)",onMouseOut:t=>t.currentTarget.style.transform="scale(1)",children:"ðŸ“ Open Sticky Notes"})]}),r("p",{style:{margin:"1rem 0",color:"#4b5563",fontSize:"1rem"},children:[r("strong",{children:[p("type"),":"]})," ",o.typeLesson.toUpperCase()]}),u&&r("div",{style:{position:"fixed",top:`${c.y}px`,left:`${c.x}px`,backgroundColor:"#ffffff",padding:"2rem",boxShadow:"0 20px 40px rgba(0,0,0,0.15)",borderRadius:"1rem",zIndex:1e3,minWidth:"420px",maxWidth:"90vw",maxHeight:"80vh",overflowY:"auto",cursor:R?"grabbing":"default"},onMouseDown:t=>t.stopPropagation(),children:[r("div",{onMouseDown:F,style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",fontWeight:700,cursor:R?"grabbing":"grab",userSelect:"none"},children:["ðŸ“ Drag me to move",e("button",{onClick:B,style:{backgroundColor:"#ef4444",color:"#fff",padding:"0.4rem 0.8rem",borderRadius:"0.375rem",fontWeight:600,border:"none",cursor:"pointer",fontSize:"0.9rem"},title:"Close",children:"âœ–"})]}),e("h2",{style:{marginBottom:"1rem",fontSize:"1.5rem",fontWeight:700,color:"#1f2937"},children:"ðŸ—’ï¸ Your Sticky Notes"}),L&&e("div",{style:{marginTop:"2rem"},children:e(O,{file:L})}),e("textarea",{value:w,onChange:t=>h(t.target.value),placeholder:"Write something here...",style:{width:"100%",minHeight:"120px",padding:"1rem",borderRadius:"0.75rem",border:"1px solid #d1d5db",fontSize:"1rem",resize:"vertical",backgroundColor:"#f9fafb"}}),e("div",{style:{textAlign:"right",marginTop:"1rem"},children:e("button",{onClick:M,style:{backgroundColor:"#22c55e",color:"#fff",padding:"0.6rem 1.2rem",borderRadius:"0.5rem",fontWeight:600,border:"none",marginRight:"0.5rem",cursor:"pointer",transition:"0.2s ease"},children:s!==null?"âœ… Update":"âž• Add Note"})}),e("ul",{style:{marginTop:"2rem",padding:0},children:d.map((t,n)=>r("li",{style:{backgroundColor:"#fef3c7",padding:"1rem",marginBottom:"1rem",borderRadius:"0.75rem",listStyle:"none",boxShadow:"0 2px 6px rgba(0,0,0,0.1)",position:"relative"},children:[e("p",{style:{marginBottom:"0.5rem",fontSize:"1rem",color:"#374151",whiteSpace:"pre-wrap"},children:t.content}),r("small",{style:{color:"#6b7280"},children:["ðŸ•’ Updated: ",new Date(t.updatedAt).toLocaleString()]}),r("div",{style:{position:"absolute",top:"0.75rem",right:"0.75rem",display:"flex",gap:"0.5rem"},children:[e("button",{onClick:()=>j(n),style:{background:"none",border:"none",color:"#3b82f6",fontSize:"1rem",cursor:"pointer"},title:"Edit note",children:"âœï¸"}),e("button",{onClick:()=>_(n),style:{background:"none",border:"none",color:"#ef4444",fontSize:"1rem",cursor:"pointer"},title:"Delete note",children:"ðŸ—‘ï¸"})]})]},n))})]}),o.typeLesson==="image"?e("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",maxWidth:"100%",maxHeight:"80vh",overflow:"auto"},children:e("img",{src:o.fileUrl,alt:"Lesson Preview",style:{maxWidth:"100%",height:"auto",objectFit:"unset",borderRadius:"0.5rem"}})}):o.typeLesson==="pdf"?e("button",{onClick:A,disabled:l,style:{padding:"0.4rem 0.8rem",backgroundColor:"#8b5cf6",color:"#fff",border:"none",borderRadius:"0.5rem",cursor:"pointer",fontWeight:600,marginLeft:"1rem",opacity:l?.7:1,position:"relative",fontSize:"1.3rem",lineHeight:"1.4"},title:"Click to generate and save your enhanced resume",children:l?r(U,{children:[e("span",{style:{display:"inline-block",width:"0.8rem",height:"0.8rem",border:"2px solid rgba(255,255,255,0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 1s linear infinite",marginRight:"0.3rem"}}),"Generating..."]}):"ðŸ“„ Generate Resume"}):o.typeLesson==="video"?e("video",{controls:!0,style:{maxWidth:"100%",height:"auto",borderRadius:"0.5rem"},crossOrigin:"anonymous",children:e("source",{src:o.fileUrl,type:"video/mp4"})}):e("iframe",{src:o.fileUrl,title:"Lesson Preview",style:{width:"100%",height:"calc(100vh - 200px)",border:"1px solid #ccc",borderRadius:"0.5rem"}}),e("button",{onClick:()=>{const t=D||o.moduleId||o.module||o._id;console.log("Going back to module:",t),b(`/moduleDetails/course/${t}`)},style:{backgroundColor:"#4ade80",color:"white",padding:"0.6rem 1.2rem",borderRadius:"0.5rem",fontSize:"1rem",border:"none",cursor:"pointer",marginTop:"1.5rem"},children:p("buttons.back")})]})})};export{ce as default};
