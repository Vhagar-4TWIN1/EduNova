import{S as Q,U as tt,r as x,W as et,_ as Z,an as Pt,E as f,b as r,ao as It,Z as q,V as Y,j as h,a3 as E,$ as F,a0 as at,I as $t,ap as vt,X as Lt,aq as kt,a1 as W,ak as bt,ai as mt,x as At,al as Rt,a as zt,a4 as z,ad as Mt,a6 as Nt,a7 as St,a8 as wt,ab as ot,a5 as Bt,l as Ot,ar as Et,as as Ft}from"./index-C3nL3Q8Y.js";import{H as Ut}from"./header-B5dyLMZC.js";import{S as Dt}from"./Search-D22QGXhR.js";import{r as ht,a as xt}from"./jsx-runtime_commonjs-proxy-P7gUQ3kO.js";import{M as _t}from"./MenuItem-NIEDGLUA.js";import{T as rt}from"./Tooltip-BYEiyJU_.js";import{C as nt}from"./Card-BM1iOIYZ.js";import{C as st}from"./CardContent-DB49xfDB.js";import{S as Tt}from"./Stack-CAonYs3f.js";import{L as it,F as lt}from"./LastPage-GdtTYewh.js";import"./listItemTextClasses-B7Ux6p96.js";import"./useThemeProps-CRU2mqAJ.js";import"./getThemeProps-DLbyqOGa.js";function jt(t){return tt("MuiInputAdornment",t)}const ct=Q("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var dt;const Wt=["children","className","component","disablePointerEvents","disableTypography","position","variant"],qt=(t,e)=>{const{ownerState:a}=t;return[e.root,e[`position${F(a.position)}`],a.disablePointerEvents===!0&&e.disablePointerEvents,e[a.variant]]},Vt=t=>{const{classes:e,disablePointerEvents:a,hiddenLabel:s,position:g,size:b,variant:y}=t,d={root:["root",a&&"disablePointerEvents",g&&`position${F(g)}`,y,s&&"hiddenLabel",b&&`size${F(b)}`]};return at(d,jt,e)},Ht=q("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:qt})(({theme:t,ownerState:e})=>f({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(t.vars||t).palette.action.active},e.variant==="filled"&&{[`&.${ct.positionStart}&:not(.${ct.hiddenLabel})`]:{marginTop:16}},e.position==="start"&&{marginRight:8},e.position==="end"&&{marginLeft:8},e.disablePointerEvents===!0&&{pointerEvents:"none"})),Gt=x.forwardRef(function(e,a){const s=et({props:e,name:"MuiInputAdornment"}),{children:g,className:b,component:y="div",disablePointerEvents:d=!1,disableTypography:m=!1,position:C,variant:P}=s,M=Z(s,Wt),p=Pt()||{};let u=P;P&&p.variant,p&&!u&&(u=p.variant);const i=f({},s,{hiddenLabel:p.hiddenLabel,size:p.size,disablePointerEvents:d,position:C,variant:u}),B=Vt(i);return r(It.Provider,{value:null,children:r(Ht,f({as:y,ownerState:i,className:Y(B.root,b),ref:a},M,{children:typeof g=="string"&&!m?r(E,{color:"text.secondary",children:g}):h(x.Fragment,{children:[C==="start"?dt||(dt=r("span",{className:"notranslate",children:"​"})):null,g]})}))})});function Xt(t){return tt("MuiPagination",t)}Q("MuiPagination",["root","ul","outlined","text"]);const Yt=["boundaryCount","componentName","count","defaultPage","disabled","hideNextButton","hidePrevButton","onChange","page","showFirstButton","showLastButton","siblingCount"];function Zt(t={}){const{boundaryCount:e=1,componentName:a="usePagination",count:s=1,defaultPage:g=1,disabled:b=!1,hideNextButton:y=!1,hidePrevButton:d=!1,onChange:m,page:C,showFirstButton:P=!1,showLastButton:M=!1,siblingCount:p=1}=t,u=Z(t,Yt),[i,B]=$t({controlled:C,default:g,name:a,state:"page"}),v=(l,S)=>{C||B(S),m&&m(l,S)},I=(l,S)=>{const J=S-l+1;return Array.from({length:J},(K,X)=>l+X)},N=I(1,Math.min(e,s)),$=I(Math.max(s-e+1,e+1),s),D=Math.max(Math.min(i-p,s-e-p*2-1),e+2),O=Math.min(Math.max(i+p,e+p*2+2),$.length>0?$[0]-2:s-1),_=[...P?["first"]:[],...d?[]:["previous"],...N,...D>e+2?["start-ellipsis"]:e+1<s-e?[e+1]:[],...I(D,O),...O<s-e-1?["end-ellipsis"]:s-e>e?[s-e]:[],...$,...y?[]:["next"],...M?["last"]:[]],T=l=>{switch(l){case"first":return 1;case"previous":return i-1;case"next":return i+1;case"last":return s;default:return null}},k=_.map(l=>typeof l=="number"?{onClick:S=>{v(S,l)},type:"page",page:l,selected:l===i,disabled:b,"aria-current":l===i?"true":void 0}:{onClick:S=>{v(S,T(l))},type:l,page:T(l),selected:!1,disabled:b||l.indexOf("ellipsis")===-1&&(l==="next"||l==="last"?i>=s:i<=1)});return f({items:k},u)}function Jt(t){return tt("MuiPaginationItem",t)}const L=Q("MuiPaginationItem",["root","page","sizeSmall","sizeLarge","text","textPrimary","textSecondary","outlined","outlinedPrimary","outlinedSecondary","rounded","ellipsis","firstLast","previousNext","focusVisible","disabled","selected","icon","colorPrimary","colorSecondary"]),pt=vt(r("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore"),ut=vt(r("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext"),Kt=["className","color","component","components","disabled","page","selected","shape","size","slots","type","variant"],yt=(t,e)=>{const{ownerState:a}=t;return[e.root,e[a.variant],e[`size${F(a.size)}`],a.variant==="text"&&e[`text${F(a.color)}`],a.variant==="outlined"&&e[`outlined${F(a.color)}`],a.shape==="rounded"&&e.rounded,a.type==="page"&&e.page,(a.type==="start-ellipsis"||a.type==="end-ellipsis")&&e.ellipsis,(a.type==="previous"||a.type==="next")&&e.previousNext,(a.type==="first"||a.type==="last")&&e.firstLast]},Qt=t=>{const{classes:e,color:a,disabled:s,selected:g,size:b,shape:y,type:d,variant:m}=t,C={root:["root",`size${F(b)}`,m,y,a!=="standard"&&`color${F(a)}`,a!=="standard"&&`${m}${F(a)}`,s&&"disabled",g&&"selected",{page:"page",first:"firstLast",last:"firstLast","start-ellipsis":"ellipsis","end-ellipsis":"ellipsis",previous:"previousNext",next:"previousNext"}[d]],icon:["icon"]};return at(C,Jt,e)},te=q("div",{name:"MuiPaginationItem",slot:"Root",overridesResolver:yt})(({theme:t,ownerState:e})=>f({},t.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,padding:"0 6px",margin:"0 3px",color:(t.vars||t).palette.text.primary,height:"auto",[`&.${L.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},e.size==="small"&&{minWidth:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},e.size==="large"&&{minWidth:40,borderRadius:40/2,padding:"0 10px",fontSize:t.typography.pxToRem(15)})),ee=q(kt,{name:"MuiPaginationItem",slot:"Root",overridesResolver:yt})(({theme:t,ownerState:e})=>f({},t.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,height:32,padding:"0 6px",margin:"0 3px",color:(t.vars||t).palette.text.primary,[`&.${L.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${L.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},transition:t.transitions.create(["color","background-color"],{duration:t.transitions.duration.short}),"&:hover":{backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${L.selected}`]:{backgroundColor:(t.vars||t).palette.action.selected,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:W.alpha(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(t.vars||t).palette.action.selected}},[`&.${L.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:W.alpha(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)},[`&.${L.disabled}`]:{opacity:1,color:(t.vars||t).palette.action.disabled,backgroundColor:(t.vars||t).palette.action.selected}}},e.size==="small"&&{minWidth:26,height:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},e.size==="large"&&{minWidth:40,height:40,borderRadius:40/2,padding:"0 10px",fontSize:t.typography.pxToRem(15)},e.shape==="rounded"&&{borderRadius:(t.vars||t).shape.borderRadius}),({theme:t,ownerState:e})=>f({},e.variant==="text"&&{[`&.${L.selected}`]:f({},e.color!=="standard"&&{color:(t.vars||t).palette[e.color].contrastText,backgroundColor:(t.vars||t).palette[e.color].main,"&:hover":{backgroundColor:(t.vars||t).palette[e.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[e.color].main}},[`&.${L.focusVisible}`]:{backgroundColor:(t.vars||t).palette[e.color].dark}},{[`&.${L.disabled}`]:{color:(t.vars||t).palette.action.disabled}})},e.variant==="outlined"&&{border:t.vars?`1px solid rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${L.selected}`]:f({},e.color!=="standard"&&{color:(t.vars||t).palette[e.color].main,border:`1px solid ${t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / 0.5)`:W.alpha(t.palette[e.color].main,.5)}`,backgroundColor:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.activatedOpacity})`:W.alpha(t.palette[e.color].main,t.palette.action.activatedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / calc(${t.vars.palette.action.activatedOpacity} + ${t.vars.palette.action.focusOpacity}))`:W.alpha(t.palette[e.color].main,t.palette.action.activatedOpacity+t.palette.action.focusOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${L.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / calc(${t.vars.palette.action.activatedOpacity} + ${t.vars.palette.action.focusOpacity}))`:W.alpha(t.palette[e.color].main,t.palette.action.activatedOpacity+t.palette.action.focusOpacity)}},{[`&.${L.disabled}`]:{borderColor:(t.vars||t).palette.action.disabledBackground,color:(t.vars||t).palette.action.disabled}})})),ae=q("div",{name:"MuiPaginationItem",slot:"Icon",overridesResolver:(t,e)=>e.icon})(({theme:t,ownerState:e})=>f({fontSize:t.typography.pxToRem(20),margin:"0 -8px"},e.size==="small"&&{fontSize:t.typography.pxToRem(18)},e.size==="large"&&{fontSize:t.typography.pxToRem(22)})),oe=x.forwardRef(function(e,a){const s=et({props:e,name:"MuiPaginationItem"}),{className:g,color:b="standard",component:y,components:d={},disabled:m=!1,page:C,selected:P=!1,shape:M="circular",size:p="medium",slots:u={},type:i="page",variant:B="text"}=s,v=Z(s,Kt),I=f({},s,{color:b,disabled:m,selected:P,shape:M,size:p,type:i,variant:B}),N=Lt(),$=Qt(I),O=(N?{previous:u.next||d.next||ut,next:u.previous||d.previous||pt,last:u.first||d.first||lt,first:u.last||d.last||it}:{previous:u.previous||d.previous||pt,next:u.next||d.next||ut,first:u.first||d.first||lt,last:u.last||d.last||it})[i];return i==="start-ellipsis"||i==="end-ellipsis"?r(te,{ref:a,ownerState:I,className:Y($.root,g),children:"…"}):h(ee,f({ref:a,ownerState:I,component:y,disabled:m,className:Y($.root,g)},v,{children:[i==="page"&&C,O?r(ae,{as:O,ownerState:I,className:$.icon}):null]}))}),re=["boundaryCount","className","color","count","defaultPage","disabled","getItemAriaLabel","hideNextButton","hidePrevButton","onChange","page","renderItem","shape","showFirstButton","showLastButton","siblingCount","size","variant"],ne=t=>{const{classes:e,variant:a}=t;return at({root:["root",a],ul:["ul"]},Xt,e)},se=q("nav",{name:"MuiPagination",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:a}=t;return[e.root,e[a.variant]]}})({}),ie=q("ul",{name:"MuiPagination",slot:"Ul",overridesResolver:(t,e)=>e.ul})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"});function le(t,e,a){return t==="page"?`${a?"":"Go to "}page ${e}`:`Go to ${t} page`}const ce=x.forwardRef(function(e,a){const s=et({props:e,name:"MuiPagination"}),{boundaryCount:g=1,className:b,color:y="standard",count:d=1,defaultPage:m=1,disabled:C=!1,getItemAriaLabel:P=le,hideNextButton:M=!1,hidePrevButton:p=!1,renderItem:u=k=>r(oe,f({},k)),shape:i="circular",showFirstButton:B=!1,showLastButton:v=!1,siblingCount:I=1,size:N="medium",variant:$="text"}=s,D=Z(s,re),{items:O}=Zt(f({},s,{componentName:"Pagination"})),_=f({},s,{boundaryCount:g,color:y,count:d,defaultPage:m,disabled:C,getItemAriaLabel:P,hideNextButton:M,hidePrevButton:p,renderItem:u,shape:i,showFirstButton:B,showLastButton:v,siblingCount:I,size:N,variant:$}),T=ne(_);return r(se,f({"aria-label":"pagination navigation",className:Y(T.root,b),ownerState:_,ref:a},D,{children:r(ie,{className:T.ul,ownerState:_,children:O.map((k,l)=>r("li",{children:u(f({},k,{color:y,"aria-label":P(k.type,k.page,k.selected),shape:i,size:N,variant:$}))},l))})}))});var H={},gt;function de(){if(gt)return H;gt=1;var t=bt();Object.defineProperty(H,"__esModule",{value:!0}),H.default=void 0;var e=t(ht()),a=xt;return H.default=(0,e.default)((0,a.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList"),H}var pe=de();const ue=mt(pe);var G={},ft;function ge(){if(ft)return G;ft=1;var t=bt();Object.defineProperty(G,"__esModule",{value:!0}),G.default=void 0;var e=t(ht()),a=xt;return G.default=(0,e.default)((0,a.jsx)("path",{d:"M3 18h6v-2H3zM3 6v2h18V6zm0 7h12v-2H3z"}),"Sort"),G}var fe=ge();const ve=mt(fe),ze=()=>{const t=At(),e=Rt(t.palette.mode),[a,s]=x.useState([]),[g,b]=x.useState([]),[y,d]=x.useState(!0),[m,C]=x.useState(null),[P,M]=x.useState(1),[p,u]=x.useState(""),[i,B]=x.useState("all"),[v,I]=x.useState({key:"createdAt",direction:"desc"}),N=10,[$,D]=x.useState([]);x.useEffect(()=>{O()},[]);const O=async()=>{var n,o;try{const c=localStorage.getItem("token");if(!c)throw new Error("Missing token. Please log in again.");const A=(await zt.get("https://edunova-back-rqxc.onrender.com/api/auth/activity-logs",{headers:{Authorization:`Bearer ${c}`}})).data.logs||[];s(A);const R=Array.from(new Set(A.map(j=>j.email||"Unknown user")));D(["all",...R])}catch(c){console.error("Error fetching logs:",c),C(((o=(n=c.response)==null?void 0:n.data)==null?void 0:o.message)||"Error loading activity logs")}finally{d(!1)}};x.useEffect(()=>{let n=[...a];if(i!=="all"&&(n=n.filter(o=>o.email===i)),p){const o=p.toLowerCase();n=n.map(c=>{var w;return{...c,logs:((w=c.logs)==null?void 0:w.filter(A=>{var R,j,U;return(((R=A.action)==null?void 0:R.toLowerCase())||"").includes(o)||(((j=A.ipAddress)==null?void 0:j.toLowerCase())||"").includes(o)||(((U=A.userAgent)==null?void 0:U.toLowerCase())||"").includes(o)}))||[]}}).filter(c=>c.logs.length>0)}n=[...n].sort((o,c)=>{var w,A,R,j;if(v.key==="email"){const U=o.email||"",V=c.email||"";return v.direction==="asc"?U.localeCompare(V):V.localeCompare(U)}if(v.key==="createdAt"){const U=((w=o.logs)==null?void 0:w.length)>0?new Date((A=o.logs[0])==null?void 0:A.createdAt):0,V=((R=c.logs)==null?void 0:R.length)>0?new Date((j=c.logs[0])==null?void 0:j.createdAt):0;return v.direction==="asc"?U-V:V-U}return 0}),b(n),M(1)},[a,p,i,v]);const _=n=>{if(!n||isNaN(n))return"0h 0m 0s";const o=Math.floor(n/86400),c=Math.floor(n%86400/3600),w=Math.floor(n%3600/60),A=n%60;let R="";return o>0&&(R+=`${o}d `),R+=`${c}h ${w}m ${A}s`,R.trim()},T=n=>{if(!n)return"default";const o=n.toLowerCase();return o.includes("login")?"success":o.includes("logout")?"error":o.includes("create")?"info":o.includes("FORUM")?"warning":"primary"},k=n=>{I(o=>({key:n,direction:o.key===n&&o.direction==="asc"?"desc":"asc"}))},l=P*N,S=l-N,J=g.reduce((n,o)=>{var c;return n+(((c=o.logs)==null?void 0:c.length)||0)},0),K=Math.ceil(J/N),X=()=>{let n=[],o=0;for(const c of g)if(c.logs){for(const w of c.logs)if(o>=S&&o<l&&n.push({user:c,log:w}),o++,o>=l)break;if(o>=l)break}return n},Ct=(n,o)=>{M(o),window.scrollTo({top:0,behavior:"smooth"})};return h(z,{m:"20px",children:[r(Ut,{title:"Activity Logs",subtitle:"User actions history"}),h(z,{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,mb:3,alignItems:"center",children:[r(Mt,{fullWidth:!0,variant:"outlined",placeholder:"Search by action, IP or browser...",value:p,onChange:n=>u(n.target.value),InputProps:{startAdornment:r(Gt,{position:"start",children:r(Dt,{})})},sx:{flex:1,"& .MuiOutlinedInput-root":{backgroundColor:e.primary[400],borderRadius:"8px"}}}),h(z,{display:"flex",gap:2,width:{xs:"100%",md:"auto"},children:[h(Nt,{sx:{minWidth:180},children:[r(St,{id:"user-filter-label",children:"User"}),r(wt,{labelId:"user-filter-label",value:i,onChange:n=>B(n.target.value),label:"User",sx:{backgroundColor:e.primary[400],borderRadius:"8px"},children:$.map((n,o)=>r(_t,{value:n,children:n==="all"?"All users":n},o))})]}),r(rt,{title:"Sort by date",children:r(ot,{onClick:()=>k("createdAt"),sx:{backgroundColor:e.primary[400],borderRadius:"8px"},children:r(ve,{color:v.key==="createdAt"?"secondary":"inherit",sx:{transform:v.direction==="asc"?"rotate(180deg)":"none",transition:"transform 0.3s"}})})}),r(rt,{title:"Sort by user",children:r(ot,{onClick:()=>k("email"),sx:{backgroundColor:e.primary[400],borderRadius:"8px"},children:r(ue,{color:v.key==="email"?"secondary":"inherit",sx:{transform:v.direction==="asc"?"rotate(180deg)":"none",transition:"transform 0.3s"}})})})]})]}),m&&r(z,{sx:{backgroundColor:e.redAccent[700],p:2,mb:3,borderRadius:1},children:r(E,{color:"white",children:m})}),y?r(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",children:r(Bt,{color:"secondary"})}):h(Ot,{children:[r(z,{display:"flex",flexDirection:"column",gap:"15px",children:X().length>0?X().map(({user:n,log:o})=>r(nt,{sx:{backgroundColor:e.primary[400],borderRadius:"10px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",transition:"transform 0.3s","&:hover":{transform:"translateY(-2px)"}},children:h(st,{children:[h(z,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[r(E,{variant:"h5",fontWeight:"600",color:e.greenAccent[400],children:n.email||"Unknown user"}),r(Et,{label:o.action,color:T(o.action),size:"small",sx:{fontWeight:"bold"}})]}),h(z,{display:"flex",flexDirection:"column",gap:1,mt:2,children:[h(z,{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",children:[h(E,{variant:"body2",color:e.grey[100],children:[r("strong",{children:"IP Address:"})," ",o.ipAddress||"N/A"]}),h(E,{variant:"body2",color:e.grey[100],children:["• ",r("strong",{children:"Duration:"})," ",_(o.duration)]})]}),h(E,{variant:"body2",color:e.grey[100],children:[r("strong",{children:"Browser:"})," ",o.userAgent||"N/A"]}),h(z,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1,children:[r(E,{variant:"caption",color:e.grey[300],children:o.createdAt?Ft(new Date(o.createdAt),{addSuffix:!0}):"N/A"}),r(E,{variant:"caption",color:e.grey[300],children:o.createdAt?new Date(o.createdAt).toLocaleString():"N/A"})]})]})]})},o._id)):r(nt,{children:r(st,{children:r(E,{children:"No activity logs found with these criteria"})})})}),K>1&&r(z,{display:"flex",justifyContent:"center",mt:4,mb:4,children:r(Tt,{spacing:2,children:r(ce,{count:K,page:P,onChange:Ct,color:"secondary",shape:"rounded",size:"large",showFirstButton:!0,showLastButton:!0,sx:{"& .MuiPaginationItem-root":{color:e.grey[100]},"& .Mui-selected":{backgroundColor:`${e.greenAccent[600]} !important`,color:"white !important"}}})})})]})]})};export{ze as default};
