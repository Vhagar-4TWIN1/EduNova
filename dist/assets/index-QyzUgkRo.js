import{g as J,b as d}from"./vendor-gGFwV6Yc.js";import{ae as K,t as Q,af as X,j as t,a0 as u,b as r,ag as P,$ as M,a9 as n,a2 as F,a3 as D,a4 as W,a as p,a7 as I,h as S}from"./index-CNYIw3Ap.js";import{D as Z,a as ee}from"./Delete-D7ym7DY0.js";import{E as re}from"./Edit-CRyCmMnR.js";import{r as ae,a as te}from"./jsx-runtime_commonjs-proxy-B8aGQats.js";import{H as oe}from"./header-Cs2ESUnw.js";import{B as b}from"./Button-q5rqdzgK.js";import{M as g}from"./MenuItem-Cq1GJlgR.js";import{T}from"./Tooltip-B-g2_8m6.js";import{F as ne,C as le}from"./FormControlLabel-B67jigjT.js";import"./Close-B0rgw4hC.js";import"./ClickAwayListener-Fhc0bISo.js";import"./useThemeProps-C1R061y2.js";import"./getThemeProps-DCO5hL5C.js";import"./LastPage-D1pOawH5.js";import"./TableCell-CgCyTPXP.js";import"./listItemTextClasses-DelaPf-g.js";import"./Stack-BLMnx7VC.js";var x={},q;function ie(){if(q)return x;q=1;var v=K();Object.defineProperty(x,"__esModule",{value:!0}),x.default=void 0;var y=v(ae()),i=te;return x.default=(0,y.default)([(0,i.jsx)("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),(0,i.jsx)("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),x}var se=ie();const ce=J(se),Pe=({searchQuery:v})=>{const y=Q(),i=X(y.palette.mode),[j,k]=d.useState([]),[m,N]=d.useState([]),[s,C]=d.useState(null),[a,U]=d.useState({}),[E,A]=d.useState(!1),[h,R]=d.useState({firstName:"",lastName:"",age:"",email:"",country:"",role:"Student",password:""}),f=async()=>{try{const e=await p.get("https://edunova-back-rqxc.onrender.com/api/users?page=1&limit=100");if(e.data&&Array.isArray(e.data.users)){const l=e.data.users.filter(c=>c.role==="Teacher"||c.role==="Student"||c.role==="Admin");k(l)}else k([])}catch(e){console.error("❌ Failed to fetch users:",e)}};d.useEffect(()=>{f()},[]);const L=async()=>{try{if(!window.confirm(`Are you sure you want to delete ${m.length>1?"these users":"this user"}?`))return;for(const l of m)await p.delete(`https://edunova-back-rqxc.onrender.com/api/users/${l}`);N([]),f()}catch(e){console.error("Failed to delete users:",e)}},w=e=>{R({...h,[e.target.name]:e.target.value})},_=async()=>{try{await p.post("https://edunova-back-rqxc.onrender.com/api/auth/signup",h),A(!1),f()}catch(e){console.error("Failed to add user:",e)}},$=j.filter(e=>Object.values(e).some(l=>typeof l=="string"&&l.toLowerCase().includes(v.toLowerCase()))),B=e=>{C(e),U({...e})},o=e=>{const{name:l,value:c,type:Y,checked:z}=e.target;U({...a,[l]:Y==="checkbox"?z:c})},G=async()=>{try{await p.patch(`https://edunova-back-rqxc.onrender.com/api/users/${s._id}`,a),C(null),f()}catch(e){console.error("Update failed:",e)}},H=async e=>{if(window.confirm("Are you sure you want to promote this user to Admin?"))try{await p.patch(`https://edunova-back-rqxc.onrender.com/api/users/${e._id}/promote`),f()}catch(c){console.error("Promote to admin failed:",c)}},O=()=>{if(!s)return null;switch(s.role){case"Admin":return t(S,{children:[r(n,{label:"CIN",fullWidth:!0,name:"cin",value:a.cin||"",onChange:o,sx:{mb:2}}),r(n,{label:"Phone Number",fullWidth:!0,name:"number",value:a.number||"",onChange:o,sx:{mb:2}})]});case"Teacher":return t(S,{children:[r(n,{label:"Phone Number",fullWidth:!0,name:"number",value:a.number||"",onChange:o,sx:{mb:2}}),r(n,{label:"Bio",fullWidth:!0,name:"bio",value:a.bio||"",onChange:o,sx:{mb:2}}),r(n,{label:"CV",fullWidth:!0,name:"cv",value:a.cv||"",onChange:o,sx:{mb:2}}),r(n,{label:"Experience",fullWidth:!0,name:"experience",value:a.experience||"",onChange:o,sx:{mb:2}}),r(n,{label:"CIN",fullWidth:!0,name:"cin",value:a.cin||"",onChange:o,sx:{mb:2}})]});case"Student":return t(S,{children:[r(n,{label:"Identifier",fullWidth:!0,name:"identifier",value:a.identifier||"",onChange:o,sx:{mb:2}}),r(n,{label:"Situation",fullWidth:!0,name:"situation",value:a.situation||"",onChange:o,sx:{mb:2}}),r(n,{label:"Disease",fullWidth:!0,name:"disease",value:a.disease||"",onChange:o,sx:{mb:2}}),r(ne,{control:r(le,{checked:a.socialCase||!1,onChange:o,name:"socialCase"}),label:"Social Case",sx:{mb:2}}),t(F,{fullWidth:!0,sx:{mb:2},children:[r(D,{children:"Learning Preference"}),t(W,{name:"learningPreference",value:a.learningPreference||"video",onChange:o,label:"Learning Preference",children:[r(g,{value:"video",children:"Video"}),r(g,{value:"pdf",children:"PDF"})]})]})]});default:return null}},V=[{field:"firstName",headerName:"First Name",flex:1},{field:"lastName",headerName:"Last Name",flex:1},{field:"age",headerName:"Age",type:"number",flex:.5},{field:"email",headerName:"Email",flex:1.5},{field:"country",headerName:"Country",flex:1},{field:"role",headerName:"Role",flex:1},{field:"actions",headerName:"Actions",flex:1.5,renderCell:e=>t(u,{children:[r(T,{title:"Update User",children:r(I,{onClick:()=>B(e.row),children:r(re,{style:{color:i.greenAccent[500]}})})}),e.row.role!=="Admin"&&r(T,{title:"Promote to Admin",children:r(I,{onClick:l=>{l.stopPropagation(),H(e.row)},color:"primary",children:r(ce,{})})})]})}];return t(u,{m:"20px",children:[r(oe,{title:"TEAM",subtitle:"List of Users"}),r(b,{variant:"contained",color:"primary",sx:{mt:2,mb:2},onClick:()=>A(!0),children:"Add User"}),m.length>0&&t(b,{variant:"contained",color:"error",startIcon:r(Z,{}),onClick:L,sx:{mb:2},children:["Delete ",m.length>1?"Users":"User"]}),r(u,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"none"},"& .MuiDataGrid-columnHeaders":{backgroundColor:i.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:i.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:i.blueAccent[700]},"& .MuiCheckbox-root":{color:`${i.greenAccent[200]} !important`}},children:r(ee,{rows:$,columns:V,getRowId:e=>e._id,checkboxSelection:!0,onSelectionModelChange:e=>N(e),selectionModel:m})}),r(P,{open:!!s,onClose:()=>C(null),children:t(u,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,maxHeight:"80vh",overflowY:"auto"},children:[t(M,{variant:"h6",mb:2,children:["Update ",s==null?void 0:s.role," Profile"]}),["firstName","lastName","age","email","country"].map(e=>r(n,{label:e.charAt(0).toUpperCase()+e.slice(1),fullWidth:!0,name:e,value:a[e]||"",onChange:o,sx:{mb:2}},e)),O(),t(u,{display:"flex",justifyContent:"flex-end",mt:2,children:[r(b,{onClick:()=>C(null),variant:"outlined",sx:{mr:2},children:"Cancel"}),r(b,{onClick:G,variant:"contained",color:"primary",children:"Save Changes"})]})]})}),r(P,{open:E,onClose:()=>A(!1),children:t(u,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},children:[r(M,{variant:"h6",mb:2,children:"Add New User"}),["firstName","lastName","age","email","country"].map(e=>r(n,{label:e.charAt(0).toUpperCase()+e.slice(1),fullWidth:!0,name:e,value:h[e]||"",onChange:w,sx:{mb:2}},e)),t(F,{fullWidth:!0,sx:{mb:2},children:[r(D,{children:"Role"}),t(W,{name:"role",value:h.role,onChange:w,label:"Role",children:[r(g,{value:"Admin",children:"Admin"}),r(g,{value:"Teacher",children:"Teacher"}),r(g,{value:"Student",children:"Student"})]})]}),r(n,{label:"Password",type:"password",fullWidth:!0,name:"password",value:h.password||"",onChange:w,sx:{mb:2}}),r(u,{display:"flex",justifyContent:"flex-end",children:r(b,{onClick:_,variant:"contained",color:"primary",children:"Add"})})]})})]})};export{Pe as default};
