import{D as H,a as O}from"./Delete-D7ym7DY0.js";import{E as W}from"./Edit-CRyCmMnR.js";import{g as I,b as c,u as J}from"./vendor-gGFwV6Yc.js";import{ae as R,a as f,j as a,a0 as v,b as r,$ as C,ag as K,a9 as Q,aa as X,a7 as k}from"./index-CNYIw3Ap.js";import{r as q,a as $}from"./jsx-runtime_commonjs-proxy-B8aGQats.js";import{H as Y}from"./header-Cs2ESUnw.js";import{S}from"./Stack-BLMnx7VC.js";import{B as d}from"./Button-q5rqdzgK.js";import{T as D}from"./Tooltip-B-g2_8m6.js";import"./MenuItem-Cq1GJlgR.js";import"./listItemTextClasses-DelaPf-g.js";import"./Close-B0rgw4hC.js";import"./ClickAwayListener-Fhc0bISo.js";import"./useThemeProps-C1R061y2.js";import"./getThemeProps-DCO5hL5C.js";import"./FormControlLabel-B67jigjT.js";import"./LastPage-D1pOawH5.js";import"./TableCell-CgCyTPXP.js";var m={},M;function Z(){if(M)return m;M=1;var u=R();Object.defineProperty(m,"__esModule",{value:!0}),m.default=void 0;var s=u(q()),p=$;return m.default=(0,s.default)((0,p.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),m}var ee=Z();const oe=I(ee);var g={},A;function re(){if(A)return g;A=1;var u=R();Object.defineProperty(g,"__esModule",{value:!0}),g.default=void 0;var s=u(q()),p=$;return g.default=(0,s.default)((0,p.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),g}var te=re();const ne=I(te),Se=({searchQuery:u})=>{var L;const[s,p]=c.useState([]),[h,T]=c.useState([]),[_,b]=c.useState(null),[n,y]=c.useState({}),[ae,E]=c.useState(0),x=J();c.useEffect(()=>{w()},[]);const w=async()=>{try{const e=localStorage.getItem("token"),o=await f.get("https://edunova-back-rqxc.onrender.com/api/lessons",{headers:{Authorization:`Bearer ${e}`}});p(o.data||[])}catch(e){console.error("❌ Échec du chargement des leçons :",e)}},G=async e=>{const o=new FormData;return o.append("file",e),o.append("upload_preset","edunova_preset"),(await f.post("https://api.cloudinary.com/v1_1/dcf7pbfes/auto/upload",o,{onUploadProgress:i=>{E(Math.round(i.loaded*100/i.total))}})).data},j=async()=>{if(!window.confirm(`Êtes-vous sûr(e) de vouloir supprimer ${h.length>1?"ces leçons":"cette leçon"} ?`))return;const o=localStorage.getItem("token");for(const t of h)try{await f.delete(`https://edunova-back-rqxc.onrender.com/api/lessons/${t}`,{headers:{Authorization:`Bearer ${o}`}})}catch(i){console.error(`❌ Échec de la suppression de la leçon ${t} :`,i)}T([]),w()},P=e=>{b(e),y({...e})},U=e=>{y({...n,[e.target.name]:e.target.value})},B=async()=>{try{const e=localStorage.getItem("token");let o=n.fileUrl,t=n.public_id;if(n.file){const{secure_url:i,public_id:l}=await G(n.file);o=i,t=l}await f.patch(`https://edunova-back-rqxc.onrender.com/api/lessons/${_._id}`,{...n,fileUrl:o,public_id:t},{headers:{Authorization:`Bearer ${e}`}}),b(null),w()}catch(e){console.error("❌ La mise à jour a échoué :",e)}},z=async e=>{try{const o=localStorage.getItem("token"),t=await f.get(`https://edunova-back-rqxc.onrender.com/api/lessons/${e}/tts`,{headers:{Authorization:`Bearer ${o}`},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([t.data])),l=document.createElement("a");l.href=i;const V=t.headers["content-type"].includes("audio")?"mp3":"txt";l.setAttribute("download",`${e}_tts.${V}`),document.body.appendChild(l),l.click(),l.remove()}catch(o){console.error("Erreur lors du téléchargement TTS :",o),alert("Échec du téléchargement TTS")}},F=[{field:"title",headerName:"Titre",flex:1},{field:"content",headerName:"Contenu",flex:1},{field:"typeLesson",headerName:"Type",flex:.5,valueGetter:e=>{var o,t;return((o=e.row.typeLesson)==null?void 0:o.charAt(0).toUpperCase())+((t=e.row.typeLesson)==null?void 0:t.slice(1))}},{field:"fileUrl",headerName:"URL du fichier",flex:1,renderCell:e=>r("a",{href:e.value,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2",textDecoration:"underline",cursor:"pointer"},children:e.value})},{field:"actions",headerName:"Actions",flex:1.5,sortable:!1,renderCell:e=>a(S,{direction:"row",spacing:1,children:[r(D,{title:"Modifier",children:r(k,{onClick:()=>P(e.row),children:r(W,{color:"primary"})})}),r(D,{title:"Télécharger TTS",children:r(k,{onClick:o=>{o.stopPropagation(),z(e.row._id)},children:r(oe,{})})}),r(D,{title:"Voir les détails",children:r(k,{onClick:()=>x(`/dashboard/lesson/${e.row._id}`),children:r(ne,{})})})]})}],N=s.filter(e=>{const o=(u||"").toLowerCase();return e.title.toLowerCase().includes(o)||e.content.toLowerCase().includes(o)||e.typeLesson&&e.typeLesson.toLowerCase().includes(o)});return a(v,{m:"20px",children:[r(Y,{title:"LEÇONS",subtitle:"Gérez toutes vos leçons et conférences"}),a(S,{direction:"row",spacing:2,mb:2,children:[r(d,{variant:"contained",color:"primary",onClick:()=>x("/dashboard/create-lesson"),children:"Créer une nouvelle leçon"}),r(d,{variant:"contained",color:"secondary",onClick:()=>x("/dashboard/select-google-lessons"),children:"Importer depuis Google Classroom"}),h.length>0&&a(d,{variant:"outlined",color:"error",startIcon:r(H,{}),onClick:j,children:["Supprimer ",h.length>1?"les leçons":"la leçon"]})]}),a(v,{height:"70vh",sx:{mt:2},children:[r(O,{rows:N,columns:F,getRowId:e=>e._id,checkboxSelection:!0,onSelectionModelChange:e=>T(e),selectionModel:h,sx:{backgroundColor:"#fff",borderRadius:2,boxShadow:"0 6px 12px rgba(0,0,0,0.12)","& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"1px solid #e0e0e0"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"#eceff1",borderBottom:"none",fontWeight:600,fontSize:"0.9rem",borderTopLeftRadius:"4px",borderTopRightRadius:"4px"},"& .MuiDataGrid-columnHeader:focus, & .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-row":{transition:"background-color 0.2s ease"},"& .MuiDataGrid-row:nth-of-type(even)":{backgroundColor:"#f8f9fa"},"& .MuiDataGrid-row:hover":{backgroundColor:"#f1f3f5"},"& .MuiDataGrid-footerContainer":{borderTop:"none"}}}),s.length===0&&r(C,{mt:2,color:"textSecondary",textAlign:"center",children:"Aucune leçon disponible. Essayez de créer une leçon ou d'importer depuis Google Classroom."})]}),r(K,{open:!!_,onClose:()=>b(null),children:a(v,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",borderRadius:3,boxShadow:24,p:4},children:[r(C,{variant:"h5",mb:3,children:"Modifier la leçon"}),a(S,{spacing:2,children:[["title","content","typeLesson"].map(e=>r(Q,{name:e,label:e==="title"?"Titre":e==="content"?"Contenu":"Type",value:n[e]||"",onChange:U,fullWidth:!0},e)),a(d,{variant:"outlined",component:"label",children:["Télécharger un fichier",r("input",{type:"file",hidden:!0,onChange:e=>{var o;return y({...n,file:(o=e.target.files)==null?void 0:o[0]})}})]}),((L=n.file)==null?void 0:L.name)&&a(C,{variant:"caption",children:["Sélectionné : ",n.file.name]})]}),r(X,{sx:{my:3}}),a(v,{textAlign:"right",children:[r(d,{onClick:()=>b(null),sx:{mr:2},children:"Annuler"}),r(d,{variant:"contained",onClick:B,children:"Enregistrer les modifications"})]})]})})]})};export{Se as default};
