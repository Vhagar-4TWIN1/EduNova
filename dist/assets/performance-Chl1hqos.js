import{r as s,u as C,j as o,b as a,a as A,aR as L}from"./index-C3nL3Q8Y.js";import{R as v,T as y,k as D,B as k,l as R}from"./generateCategoricalChart-CvR6AqMP.js";import{B as $,C as B,X as T,Y as F}from"./BarChart-DBc51VD8.js";import{P,a as N}from"./PieChart-5wuZPdz3.js";import"./_baseAssignValue-yCO_M4x6.js";import"./utcTime-C32BygsA.js";import"./stack-CIUvCgG4.js";import"./array-2GBN5xbU.js";import"./line-2rKZl4bH.js";import"./area-BH-z56A1.js";const X=()=>{const[f,w]=s.useState([]),[l,c]=s.useState(!0),[d,x]=s.useState(""),[i,S]=s.useState("7days"),[E,I]=s.useState("overview"),m=localStorage.getItem("token"),p=C(),u=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8"];s.useEffect(()=>{if(!m){p("/login");return}const t=(r,n,g=1)=>{L.event({category:"Student_Performance",action:r,label:n,value:g})};(async()=>{try{c(!0);const r=await A.get(`http://localhost:3000/api/performance/performance?range=${i}`,{headers:{Authorization:`Bearer ${m}`}});w(r.data||[]),c(!1),t("View_Dashboard",`Range: ${i}`)}catch(r){console.error("Failed to fetch performance data:",r),x("Failed to load performance data"),c(!1),t("Error",`Fetch_Performance_Data: ${r.message}`)}})()},[i,m,p]);const h=()=>{const t=new Map;return f.forEach(e=>{if(e.action==="view_file"&&e.lessonId&&e.userId){const r=`${e.lessonId}_${e.lessonTitle}`;t.has(r)||t.set(r,{name:e.lessonTitle||`Lesson ${e.lessonId}`,views:0,users:new Set,userList:new Set});const n=t.get(r);n.views++,n.users.add(e.userId);const g=typeof e.userName=="string"?e.userName:typeof e.firstName=="string"&&typeof e.lastName=="string"?`${e.firstName} ${e.lastName}`:`User ${String(e.userId).slice(0,6)}`;n.userList.add(g)}}),Array.from(t.values()).map(e=>({...e,userCount:e.users.size,userList:Array.from(e.userList)})).sort((e,r)=>r.views-e.views).slice(0,5)},b=()=>{const t={};return f.forEach(e=>{t[e.action]=(t[e.action]||0)+1}),Object.entries(t).map(([e,r])=>({name:e,value:r}))};return o("div",{style:{padding:"2rem",backgroundColor:"#f9fafb",minHeight:"100vh"},children:[a("h1",{style:{fontSize:"2rem",fontWeight:"bold",marginBottom:"1.5rem",color:"#111827"},children:"Student Performance Analytics"}),a("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem"},children:["24hours","7days","30days"].map(t=>a("button",{onClick:()=>S(t),style:{padding:"0.5rem 1rem",backgroundColor:i===t?"#2563eb":"#e5e7eb",color:i===t?"white":"#4b5563",border:"none",borderRadius:"0.375rem",cursor:"pointer"},children:t==="24hours"?"Last 24 Hours":t==="7days"?"Last 7 Days":"Last 30 Days"},t))}),l&&a("div",{style:{textAlign:"center",padding:"2rem"},children:"Loading..."}),d&&a("div",{style:{backgroundColor:"#fee2e2",color:"#b91c1c",padding:"1rem",borderRadius:"0.5rem",marginBottom:"1rem",textAlign:"center"},children:d}),!l&&!d&&h().length===0&&a("div",{style:{textAlign:"center",color:"#6b7280",marginTop:"2rem"},children:"No data available for the selected time range."}),!l&&!d&&h().length>0&&o("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem",marginTop:"2rem"},children:[o("div",{style:{backgroundColor:"white",borderRadius:"0.75rem",padding:"1.5rem",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.05)"},children:[a("h3",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"Top 5 Viewed Lessons"}),a("div",{style:{height:"300px"},children:a(v,{width:"100%",height:"100%",children:o($,{data:h(),children:[a(B,{strokeDasharray:"3 3"}),a(T,{dataKey:"name",interval:0,tick:{fontSize:12},angle:-15,textAnchor:"end"}),a(F,{}),a(y,{formatter:(t,e)=>[t,e==="views"?"Views":e]}),a(D,{}),a(k,{dataKey:"views",fill:"#2563eb",name:"Views"})]})})})]}),o("div",{style:{backgroundColor:"white",borderRadius:"0.75rem",padding:"1.5rem",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.05)"},children:[a("h3",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem"},children:"Action Distribution"}),a("div",{style:{height:"300px"},children:a(v,{width:"100%",height:"100%",children:o(P,{children:[a(N,{data:b(),cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:t,percent:e})=>`${t}: ${(e*100).toFixed(0)}%`,children:b().map((t,e)=>a(R,{fill:u[e%u.length]},`cell-${e}`))}),a(y,{})]})})})]})]})]})};export{X as default};
