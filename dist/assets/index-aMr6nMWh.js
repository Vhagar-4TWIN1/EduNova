import{R as G,V as rt,b as i,j as v,r as k,a as ft}from"./index-C3nL3Q8Y.js";import{B as M}from"./button-CdURjvta.js";import{D as mt,f as yt,E as vt,L as X,a as V,C as gt,A as bt,i as $,b as Z,h as xt,c as At,g as lt,u as wt,G as Pt,d as nt,e as St,j as Dt,R as Y,T as q,k as J,B as Ot}from"./generateCategoricalChart-CvR6AqMP.js";import{y as Nt,M as kt}from"./_baseAssignValue-yCO_M4x6.js";import{X as z,Y as K,C as Q,B as jt}from"./BarChart-DBc51VD8.js";import"./utcTime-C32BygsA.js";import"./stack-CIUvCgG4.js";import"./array-2GBN5xbU.js";import"./line-2rKZl4bH.js";import"./area-BH-z56A1.js";var _t=["type","layout","connectNulls","ref"],Et=["key"];function C(t){"@babel/helpers - typeof";return C=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},C(t)}function at(t,r){if(t==null)return{};var n=Ct(t,r),e,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(a=0;a<s.length;a++)e=s[a],!(r.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(t,e)&&(n[e]=t[e])}return n}function Ct(t,r){if(t==null)return{};var n={};for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){if(r.indexOf(e)>=0)continue;n[e]=t[e]}return n}function it(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);r&&(e=e.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,e)}return n}function P(t){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?it(Object(n),!0).forEach(function(e){D(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function E(t){return Bt(t)||It(t)||Tt(t)||Lt()}function Lt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tt(t,r){if(t){if(typeof t=="string")return tt(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tt(t,r)}}function It(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Bt(t){if(Array.isArray(t))return tt(t)}function tt(t,r){(r==null||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function Rt(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function ot(t,r){for(var n=0;n<r.length;n++){var e=r[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,ut(e.key),e)}}function $t(t,r,n){return r&&ot(t.prototype,r),n&&ot(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Kt(t,r,n){return r=U(r),Ft(t,ct()?Reflect.construct(r,n||[],U(t).constructor):r.apply(t,n))}function Ft(t,r){if(r&&(C(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Wt(t)}function Wt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ct=function(){return!!t})()}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},U(t)}function Mt(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&et(t,r)}function et(t,r){return et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,a){return e.__proto__=a,e},et(t,r)}function D(t,r,n){return r=ut(r),r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function ut(t){var r=Vt(t,"string");return C(r)=="symbol"?r:r+""}function Vt(t,r){if(C(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var e=n.call(t,r);if(C(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var j=function(t){function r(){var n;Rt(this,r);for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return n=Kt(this,r,[].concat(a)),D(n,"state",{isAnimationFinished:!0,totalLength:0}),D(n,"generateSimpleStrokeDasharray",function(o,l){return"".concat(l,"px ").concat(o-l,"px")}),D(n,"getStrokeDasharray",function(o,l,u){var p=u.reduce(function(g,b){return g+b});if(!p)return n.generateSimpleStrokeDasharray(l,o);for(var m=Math.floor(o/p),y=o%p,f=l-o,h=[],c=0,d=0;c<u.length;d+=u[c],++c)if(d+u[c]>y){h=[].concat(E(u.slice(0,c)),[y-d]);break}var A=h.length%2===0?[0,f]:[f];return[].concat(E(r.repeat(u,m)),E(h),A).map(function(g){return"".concat(g,"px")}).join(", ")}),D(n,"id",wt("recharts-line-")),D(n,"pathRef",function(o){n.mainCurve=o}),D(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0}),n.props.onAnimationEnd&&n.props.onAnimationEnd()}),D(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1}),n.props.onAnimationStart&&n.props.onAnimationStart()}),n}return Mt(r,t),$t(r,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();this.setState({totalLength:e})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();e!==this.state.totalLength&&this.setState({totalLength:e})}}},{key:"getTotalLength",value:function(){var e=this.mainCurve;try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(e,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var s=this.props,o=s.points,l=s.xAxis,u=s.yAxis,p=s.layout,m=s.children,y=yt(m,vt);if(!y)return null;var f=function(d,A){return{x:d.x,y:d.y,value:d.value,errorVal:lt(d.payload,A)}},h={clipPath:e?"url(#clipPath-".concat(a,")"):null};return i(X,{...h,children:y.map(function(c){return G.cloneElement(c,{key:"bar-".concat(c.props.dataKey),data:o,xAxis:l,yAxis:u,layout:p,dataPointFormatter:f})})})}},{key:"renderDots",value:function(e,a,s){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var l=this.props,u=l.dot,p=l.points,m=l.dataKey,y=V(this.props,!1),f=V(u,!0),h=p.map(function(d,A){var g=P(P(P({key:"dot-".concat(A),r:3},y),f),{},{index:A,cx:d.x,cy:d.y,value:d.value,dataKey:m,payload:d.payload,points:p});return r.renderDotItem(u,g)}),c={clipPath:e?"url(#clipPath-".concat(a?"":"dots-").concat(s,")"):null};return i(X,{className:"recharts-line-dots",...c,children:h},"dots")}},{key:"renderCurveStatically",value:function(e,a,s,o){var l=this.props,u=l.type,p=l.layout,m=l.connectNulls;l.ref;var y=at(l,_t),f=P(P(P({},V(y,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(s,")"):null,points:e},o),{},{type:u,layout:p,connectNulls:m});return i(gt,{...f,pathRef:this.pathRef})}},{key:"renderCurveWithAnimation",value:function(e,a){var s=this,o=this.props,l=o.points,u=o.strokeDasharray,p=o.isAnimationActive,m=o.animationBegin,y=o.animationDuration,f=o.animationEasing,h=o.animationId,c=o.animateNewValues,d=o.width,A=o.height,g=this.state,b=g.prevPoints,O=g.totalLength;return i(bt,{begin:m,duration:y,isActive:p,easing:f,from:{t:0},to:{t:1},onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart,children:function(S){var x=S.t;if(b){var L=b.length/l.length,N=l.map(function(w,H){var B=Math.floor(H*L);if(b[B]){var R=b[B],_=$(R.x,w.x),dt=$(R.y,w.y);return P(P({},w),{},{x:_(x),y:dt(x)})}if(c){var ht=$(d*2,w.x),pt=$(A/2,w.y);return P(P({},w),{},{x:ht(x),y:pt(x)})}return P(P({},w),{},{x:w.x,y:w.y})});return s.renderCurveStatically(N,e,a)}var F=$(0,O),T=F(x),I;if(u){var W="".concat(u).split(/[,\s]+/gim).map(function(w){return parseFloat(w)});I=s.getStrokeDasharray(T,O,W)}else I=s.generateSimpleStrokeDasharray(O,T);return s.renderCurveStatically(l,e,a,{strokeDasharray:I})}},"line-".concat(h))}},{key:"renderCurve",value:function(e,a){var s=this.props,o=s.points,l=s.isAnimationActive,u=this.state,p=u.prevPoints,m=u.totalLength;return l&&o&&o.length&&(!p&&m>0||!kt(p,o))?this.renderCurveWithAnimation(e,a):this.renderCurveStatically(o,e,a)}},{key:"render",value:function(){var e,a=this.props,s=a.hide,o=a.dot,l=a.points,u=a.className,p=a.xAxis,m=a.yAxis,y=a.top,f=a.left,h=a.width,c=a.height,d=a.isAnimationActive,A=a.id;if(s||!l||!l.length)return null;var g=this.state.isAnimationFinished,b=l.length===1,O=rt("recharts-line",u),S=p&&p.allowDataOverflow,x=m&&m.allowDataOverflow,L=S||x,N=Z(A)?this.id:A,F=(e=V(o,!1))!==null&&e!==void 0?e:{r:3,strokeWidth:2},T=F.r,I=T===void 0?3:T,W=F.strokeWidth,w=W===void 0?2:W,H=xt(o)?o:{},B=H.clipDot,R=B===void 0?!0:B,_=I*2+w;return v(X,{className:O,children:[S||x?v("defs",{children:[i("clipPath",{id:"clipPath-".concat(N),children:i("rect",{x:S?f:f-h/2,y:x?y:y-c/2,width:S?h:h*2,height:x?c:c*2})}),!R&&i("clipPath",{id:"clipPath-dots-".concat(N),children:i("rect",{x:f-_/2,y:y-_/2,width:h+_,height:c+_})})]}):null,!b&&this.renderCurve(L,N),this.renderErrorBar(L,N),(b||o)&&this.renderDots(L,R,N),(!d||g)&&At.renderCallByParent(this.props,l)]})}}],[{key:"getDerivedStateFromProps",value:function(e,a){return e.animationId!==a.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:a.curPoints}:e.points!==a.curPoints?{curPoints:e.points}:null}},{key:"repeat",value:function(e,a){for(var s=e.length%2!==0?[].concat(E(e),[0]):e,o=[],l=0;l<a;++l)o=[].concat(E(o),E(s));return o}},{key:"renderDotItem",value:function(e,a){var s;if(G.isValidElement(e))s=G.cloneElement(e,a);else if(Nt(e))s=e(a);else{var o=a.key,l=at(a,Et),u=rt("recharts-line-dot",typeof e!="boolean"?e.className:"");s=i(mt,{...l,className:u},o)}return s}}])}(k.PureComponent);D(j,"displayName","Line");D(j,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Pt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});D(j,"getComposedData",function(t){var r=t.props,n=t.xAxis,e=t.yAxis,a=t.xAxisTicks,s=t.yAxisTicks,o=t.dataKey,l=t.bandSize,u=t.displayedData,p=t.offset,m=r.layout,y=u.map(function(f,h){var c=lt(f,o);return m==="horizontal"?{x:nt({axis:n,ticks:a,bandSize:l,entry:f,index:h}),y:Z(c)?null:e.scale(c),value:c,payload:f}:{x:Z(c)?null:n.scale(c),y:nt({axis:e,ticks:s,bandSize:l,entry:f,index:h}),value:c,payload:f}});return P({points:y,layout:m},p)});var st=St({chartName:"LineChart",GraphicalChild:j,axisComponents:[{axisType:"xAxis",AxisComp:z},{axisType:"yAxis",AxisComp:K}],formatAxisMap:Dt});const zt=t=>{const r=t.slice(0,4),n=t.slice(4,6);return`${t.slice(6,8)}/${n}/${r}`},ee=()=>{const[t,r]=k.useState(null),[n,e]=k.useState(!0),[a,s]=k.useState(null),[o,l]=k.useState([]),[u,p]=k.useState([]);if(k.useEffect(()=>{const h=async()=>{try{const d=await fetch("http://localhost:3000/api/analytics");if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);if(!d.headers.get("content-type").includes("application/json"))throw new TypeError("Response is not JSON");const g=await d.json();g.sessions=g.sessions.map(b=>({...b,date:zt(b.date)})),r(g)}catch(d){console.error("Error fetching analytics:",d),s(d.message)}finally{e(!1)}};(async()=>{try{const d=await ft.get("http://localhost:3000/api/performance/stats/usage"),{activeHours:A,abandonEvolution:g}=d.data,b={};A.forEach(S=>{const x=S._id.hour;b[x]=(b[x]||0)+S.count});const O=Object.entries(b).map(([S,x])=>({hour:`${S}:00`,count:x}));l(O),p(g||[])}catch(d){console.error("Error loading stats:",d)}})(),h()},[]),n)return i("div",{className:"p-4",children:"Loading data..."});if(a)return v("div",{className:"p-4 text-red-500",children:["Error: ",a]});if(!t)return i("div",{className:"p-4",children:"No data available"});const m=t.sessions.reduce((h,c)=>h+Number(c.users),0),y=t.sessions.reduce((h,c)=>h+Number(c.sessions),0),f=t.pages.reduce((h,c)=>h+Number(c.pageViews),0);return v("div",{className:"dashboard p-6 space-y-10",children:[v("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:[i("h2",{className:"text-3xl font-bold",children:"📊 Analytics Dashboard"}),v("div",{className:"flex flex-wrap gap-2",children:[i(M,{variant:"outline",onClick:()=>window.location.href="/dashboard/performance",children:"🎓 Student Performance"}),i(M,{variant:"outline",onClick:()=>window.location.href="/dashboard/invoices",children:"🧾 Activity Logs"}),i(M,{variant:"outline",onClick:()=>window.location.href="/dashboard/predict",children:"🤖 Abandon Prediction"}),i(M,{variant:"outline",onClick:()=>window.location.href="/dashboard/quizResult",children:"📋 Quiz Results"})]})]}),v("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:[v("div",{className:"p-4 bg-white rounded-xl shadow text-center",children:[i("h4",{className:"text-sm text-gray-500",children:"👥 Active Users"}),i("p",{className:"text-xl font-bold",children:m})]}),v("div",{className:"p-4 bg-white rounded-xl shadow text-center",children:[i("h4",{className:"text-sm text-gray-500",children:"📈 Sessions"}),i("p",{className:"text-xl font-bold",children:y})]}),v("div",{className:"p-4 bg-white rounded-xl shadow text-center",children:[i("h4",{className:"text-sm text-gray-500",children:"👁️ Page Views"}),i("p",{className:"text-xl font-bold",children:f})]}),v("div",{className:"p-4 bg-white rounded-xl shadow text-center",children:[i("h4",{className:"text-sm text-gray-500",children:"⏱️ Abandon Rate"}),i("p",{className:"text-xl font-bold",children:u.length>0?`${u.at(-1).rate.toFixed(2)}%`:"—"})]})]}),v("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-10",children:[v("div",{className:"bg-white p-5 rounded-xl shadow",children:[i("h3",{className:"text-lg font-semibold mb-4",children:"📆 Daily Traffic"}),i(Y,{width:"100%",height:300,children:v(st,{data:t.sessions,children:[i(Q,{strokeDasharray:"3 3"}),i(z,{dataKey:"date"}),i(K,{yAxisId:"left"}),i(K,{yAxisId:"right",orientation:"right"}),i(q,{}),i(J,{}),i(j,{yAxisId:"left",type:"monotone",dataKey:"sessions",stroke:"#8884d8",name:"Sessions",activeDot:{r:8}}),i(j,{yAxisId:"right",type:"monotone",dataKey:"users",stroke:"#82ca9d",name:"Users"})]})})]}),v("div",{className:"bg-white p-5 rounded-xl shadow",children:[i("h3",{className:"text-lg font-semibold mb-4",children:"⏰ Most Active Hours"}),i(Y,{width:"100%",height:300,children:v(jt,{data:o,children:[i(Q,{strokeDasharray:"3 3"}),i(z,{dataKey:"hour"}),i(K,{}),i(q,{}),i(J,{}),i(Ot,{dataKey:"count",fill:"#8884d8",name:"Users"})]})})]}),v("div",{className:"bg-white p-5 rounded-xl shadow",children:[i("h3",{className:"text-lg font-semibold mb-4",children:"📉 Abandon Rate Over Time"}),i(Y,{width:"100%",height:300,children:v(st,{data:u,children:[i(Q,{strokeDasharray:"3 3"}),i(z,{dataKey:"date"}),i(K,{unit:"%"}),i(q,{}),i(J,{}),i(j,{type:"monotone",dataKey:"rate",stroke:"#ff6b6b",strokeWidth:2,name:"Abandon Rate"})]})})]})]})]})};export{ee as default};
