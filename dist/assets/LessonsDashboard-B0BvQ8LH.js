import{D as H,a as O}from"./Delete-BDaq_0IK.js";import{E as W}from"./Edit-Bwx8e3Tx.js";import{ak as I,ai as R,r as c,u as J,a as f,j as n,a4 as y,b as t,a3 as C,am as K,ad as Q,ae as X,ab as k}from"./index-C3nL3Q8Y.js";import{r as E,a as G}from"./jsx-runtime_commonjs-proxy-P7gUQ3kO.js";import{H as Y}from"./header-B5dyLMZC.js";import{S}from"./Stack-CAonYs3f.js";import{B as d}from"./Button-Dg9Z3r8Z.js";import{T as D}from"./Tooltip-BYEiyJU_.js";import"./MenuItem-NIEDGLUA.js";import"./listItemTextClasses-B7Ux6p96.js";import"./Close-ChL254u0.js";import"./ClickAwayListener-C_h-5Qdg.js";import"./useThemeProps-CRU2mqAJ.js";import"./getThemeProps-DLbyqOGa.js";import"./FormControlLabel-BHfDsEEE.js";import"./LastPage-GdtTYewh.js";import"./TableCell-B1lZrvz4.js";var m={},M;function Z(){if(M)return m;M=1;var u=I();Object.defineProperty(m,"__esModule",{value:!0}),m.default=void 0;var s=u(E()),p=G;return m.default=(0,s.default)((0,p.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),m}var ee=Z();const oe=R(ee);var g={},A;function te(){if(A)return g;A=1;var u=I();Object.defineProperty(g,"__esModule",{value:!0}),g.default=void 0;var s=u(E()),p=G;return g.default=(0,s.default)((0,p.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),g}var re=te();const ae=R(re),ke=({searchQuery:u})=>{var L;const[s,p]=c.useState([]),[h,T]=c.useState([]),[_,b]=c.useState(null),[a,v]=c.useState({}),[ne,$]=c.useState(0),w=J();c.useEffect(()=>{x()},[]);const x=async()=>{try{const e=localStorage.getItem("token"),o=await f.get("http://localhost:3000/api/lessons",{headers:{Authorization:`Bearer ${e}`}});p(o.data||[])}catch(e){console.error("❌ Échec du chargement des leçons :",e)}},j=async e=>{const o=new FormData;return o.append("file",e),o.append("upload_preset","edunova_preset"),(await f.post("https://api.cloudinary.com/v1_1/dcf7pbfes/auto/upload",o,{onUploadProgress:i=>{$(Math.round(i.loaded*100/i.total))}})).data},P=async()=>{if(!window.confirm(`Êtes-vous sûr(e) de vouloir supprimer ${h.length>1?"ces leçons":"cette leçon"} ?`))return;const o=localStorage.getItem("token");for(const r of h)try{await f.delete(`http://localhost:3000/api/lessons/${r}`,{headers:{Authorization:`Bearer ${o}`}})}catch(i){console.error(`❌ Échec de la suppression de la leçon ${r} :`,i)}T([]),x()},U=e=>{b(e),v({...e})},q=e=>{v({...a,[e.target.name]:e.target.value})},B=async()=>{try{const e=localStorage.getItem("token");let o=a.fileUrl,r=a.public_id;if(a.file){const{secure_url:i,public_id:l}=await j(a.file);o=i,r=l}await f.patch(`http://localhost:3000/api/lessons/${_._id}`,{...a,fileUrl:o,public_id:r},{headers:{Authorization:`Bearer ${e}`}}),b(null),x()}catch(e){console.error("❌ La mise à jour a échoué :",e)}},z=async e=>{try{const o=localStorage.getItem("token"),r=await f.get(`http://localhost:3000/api/lessons/${e}/tts`,{headers:{Authorization:`Bearer ${o}`},responseType:"blob"}),i=window.URL.createObjectURL(new Blob([r.data])),l=document.createElement("a");l.href=i;const V=r.headers["content-type"].includes("audio")?"mp3":"txt";l.setAttribute("download",`${e}_tts.${V}`),document.body.appendChild(l),l.click(),l.remove()}catch(o){console.error("Erreur lors du téléchargement TTS :",o),alert("Échec du téléchargement TTS")}},F=[{field:"title",headerName:"Titre",flex:1},{field:"content",headerName:"Contenu",flex:1},{field:"typeLesson",headerName:"Type",flex:.5,valueGetter:e=>{var o,r;return((o=e.row.typeLesson)==null?void 0:o.charAt(0).toUpperCase())+((r=e.row.typeLesson)==null?void 0:r.slice(1))}},{field:"fileUrl",headerName:"URL du fichier",flex:1,renderCell:e=>t("a",{href:e.value,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2",textDecoration:"underline",cursor:"pointer"},children:e.value})},{field:"actions",headerName:"Actions",flex:1.5,sortable:!1,renderCell:e=>n(S,{direction:"row",spacing:1,children:[t(D,{title:"Modifier",children:t(k,{onClick:()=>U(e.row),children:t(W,{color:"primary"})})}),t(D,{title:"Télécharger TTS",children:t(k,{onClick:o=>{o.stopPropagation(),z(e.row._id)},children:t(oe,{})})}),t(D,{title:"Voir les détails",children:t(k,{onClick:()=>w(`/dashboard/lesson/${e.row._id}`),children:t(ae,{})})})]})}],N=s.filter(e=>{const o=(u||"").toLowerCase();return e.title.toLowerCase().includes(o)||e.content.toLowerCase().includes(o)||e.typeLesson&&e.typeLesson.toLowerCase().includes(o)});return n(y,{m:"20px",children:[t(Y,{title:"LEÇONS",subtitle:"Gérez toutes vos leçons et conférences"}),n(S,{direction:"row",spacing:2,mb:2,children:[t(d,{variant:"contained",color:"primary",onClick:()=>w("/dashboard/create-lesson"),children:"Créer une nouvelle leçon"}),t(d,{variant:"contained",color:"secondary",onClick:()=>w("/dashboard/select-google-lessons"),children:"Importer depuis Google Classroom"}),h.length>0&&n(d,{variant:"outlined",color:"error",startIcon:t(H,{}),onClick:P,children:["Supprimer ",h.length>1?"les leçons":"la leçon"]})]}),n(y,{height:"70vh",sx:{mt:2},children:[t(O,{rows:N,columns:F,getRowId:e=>e._id,checkboxSelection:!0,onSelectionModelChange:e=>T(e),selectionModel:h,sx:{backgroundColor:"#fff",borderRadius:2,boxShadow:"0 6px 12px rgba(0,0,0,0.12)","& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"1px solid #e0e0e0"},"& .MuiDataGrid-columnHeaders":{backgroundColor:"#eceff1",borderBottom:"none",fontWeight:600,fontSize:"0.9rem",borderTopLeftRadius:"4px",borderTopRightRadius:"4px"},"& .MuiDataGrid-columnHeader:focus, & .MuiDataGrid-cell:focus":{outline:"none"},"& .MuiDataGrid-row":{transition:"background-color 0.2s ease"},"& .MuiDataGrid-row:nth-of-type(even)":{backgroundColor:"#f8f9fa"},"& .MuiDataGrid-row:hover":{backgroundColor:"#f1f3f5"},"& .MuiDataGrid-footerContainer":{borderTop:"none"}}}),s.length===0&&t(C,{mt:2,color:"textSecondary",textAlign:"center",children:"Aucune leçon disponible. Essayez de créer une leçon ou d'importer depuis Google Classroom."})]}),t(K,{open:!!_,onClose:()=>b(null),children:n(y,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:500,bgcolor:"background.paper",borderRadius:3,boxShadow:24,p:4},children:[t(C,{variant:"h5",mb:3,children:"Modifier la leçon"}),n(S,{spacing:2,children:[["title","content","typeLesson"].map(e=>t(Q,{name:e,label:e==="title"?"Titre":e==="content"?"Contenu":"Type",value:a[e]||"",onChange:q,fullWidth:!0},e)),n(d,{variant:"outlined",component:"label",children:["Télécharger un fichier",t("input",{type:"file",hidden:!0,onChange:e=>{var o;return v({...a,file:(o=e.target.files)==null?void 0:o[0]})}})]}),((L=a.file)==null?void 0:L.name)&&n(C,{variant:"caption",children:["Sélectionné : ",a.file.name]})]}),t(X,{sx:{my:3}}),n(y,{textAlign:"right",children:[t(d,{onClick:()=>b(null),sx:{mr:2},children:"Annuler"}),t(d,{variant:"contained",onClick:B,children:"Enregistrer les modifications"})]})]})})]})};export{ke as default};
