import{ak as J,ai as K,x as Q,al as X,r as d,j as a,a4 as u,b as r,am as P,a3 as M,ad as n,a6 as F,a7 as D,a8 as W,a as f,ab as I,l as S}from"./index-C3nL3Q8Y.js";import{D as Z,a as ee}from"./Delete-BDaq_0IK.js";import{E as re}from"./Edit-Bwx8e3Tx.js";import{r as te,a as ae}from"./jsx-runtime_commonjs-proxy-P7gUQ3kO.js";import{H as oe}from"./header-B5dyLMZC.js";import{B as b}from"./Button-Dg9Z3r8Z.js";import{M as g}from"./MenuItem-NIEDGLUA.js";import{T}from"./Tooltip-BYEiyJU_.js";import{F as ne,C as le}from"./FormControlLabel-BHfDsEEE.js";import"./Close-ChL254u0.js";import"./ClickAwayListener-C_h-5Qdg.js";import"./useThemeProps-CRU2mqAJ.js";import"./getThemeProps-DLbyqOGa.js";import"./LastPage-GdtTYewh.js";import"./TableCell-B1lZrvz4.js";import"./listItemTextClasses-B7Ux6p96.js";import"./Stack-CAonYs3f.js";var x={},j;function ie(){if(j)return x;j=1;var v=J();Object.defineProperty(x,"__esModule",{value:!0}),x.default=void 0;var y=v(te()),i=ae;return x.default=(0,y.default)([(0,i.jsx)("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),(0,i.jsx)("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),x}var se=ie();const ce=K(se),ke=({searchQuery:v})=>{const y=Q(),i=X(y.palette.mode),[E,N]=d.useState([]),[m,U]=d.useState([]),[s,C]=d.useState(null),[t,k]=d.useState({}),[R,A]=d.useState(!1),[h,L]=d.useState({firstName:"",lastName:"",age:"",email:"",country:"",role:"Student",password:""}),p=async()=>{try{const e=await f.get("https://edunova-back-rqxc.onrender.com/api/users?page=1&limit=100");if(e.data&&Array.isArray(e.data.users)){const l=e.data.users.filter(c=>c.role==="Teacher"||c.role==="Student"||c.role==="Admin");N(l)}else N([])}catch(e){console.error("❌ Failed to fetch users:",e)}};d.useEffect(()=>{p()},[]);const _=async()=>{try{if(!window.confirm(`Are you sure you want to delete ${m.length>1?"these users":"this user"}?`))return;for(const l of m)await f.delete(`https://edunova-back-rqxc.onrender.com/api/users/${l}`);U([]),p()}catch(e){console.error("Failed to delete users:",e)}},w=e=>{L({...h,[e.target.name]:e.target.value})},q=async()=>{try{await f.post("https://edunova-back-rqxc.onrender.com/api/auth/signup",h),A(!1),p()}catch(e){console.error("Failed to add user:",e)}},B=E.filter(e=>Object.values(e).some(l=>typeof l=="string"&&l.toLowerCase().includes(v.toLowerCase()))),$=e=>{C(e),k({...e})},o=e=>{const{name:l,value:c,type:Y,checked:z}=e.target;k({...t,[l]:Y==="checkbox"?z:c})},G=async()=>{try{await f.patch(`https://edunova-back-rqxc.onrender.com/api/users/${s._id}`,t),C(null),p()}catch(e){console.error("Update failed:",e)}},H=async e=>{if(window.confirm("Are you sure you want to promote this user to Admin?"))try{await f.patch(`https://edunova-back-rqxc.onrender.com/api/users/${e._id}/promote`),p()}catch(c){console.error("Promote to admin failed:",c)}},O=()=>{if(!s)return null;switch(s.role){case"Admin":return a(S,{children:[r(n,{label:"CIN",fullWidth:!0,name:"cin",value:t.cin||"",onChange:o,sx:{mb:2}}),r(n,{label:"Phone Number",fullWidth:!0,name:"number",value:t.number||"",onChange:o,sx:{mb:2}})]});case"Teacher":return a(S,{children:[r(n,{label:"Phone Number",fullWidth:!0,name:"number",value:t.number||"",onChange:o,sx:{mb:2}}),r(n,{label:"Bio",fullWidth:!0,name:"bio",value:t.bio||"",onChange:o,sx:{mb:2}}),r(n,{label:"CV",fullWidth:!0,name:"cv",value:t.cv||"",onChange:o,sx:{mb:2}}),r(n,{label:"Experience",fullWidth:!0,name:"experience",value:t.experience||"",onChange:o,sx:{mb:2}}),r(n,{label:"CIN",fullWidth:!0,name:"cin",value:t.cin||"",onChange:o,sx:{mb:2}})]});case"Student":return a(S,{children:[r(n,{label:"Identifier",fullWidth:!0,name:"identifier",value:t.identifier||"",onChange:o,sx:{mb:2}}),r(n,{label:"Situation",fullWidth:!0,name:"situation",value:t.situation||"",onChange:o,sx:{mb:2}}),r(n,{label:"Disease",fullWidth:!0,name:"disease",value:t.disease||"",onChange:o,sx:{mb:2}}),r(ne,{control:r(le,{checked:t.socialCase||!1,onChange:o,name:"socialCase"}),label:"Social Case",sx:{mb:2}}),a(F,{fullWidth:!0,sx:{mb:2},children:[r(D,{children:"Learning Preference"}),a(W,{name:"learningPreference",value:t.learningPreference||"video",onChange:o,label:"Learning Preference",children:[r(g,{value:"video",children:"Video"}),r(g,{value:"pdf",children:"PDF"})]})]})]});default:return null}},V=[{field:"firstName",headerName:"First Name",flex:1},{field:"lastName",headerName:"Last Name",flex:1},{field:"age",headerName:"Age",type:"number",flex:.5},{field:"email",headerName:"Email",flex:1.5},{field:"country",headerName:"Country",flex:1},{field:"role",headerName:"Role",flex:1},{field:"actions",headerName:"Actions",flex:1.5,renderCell:e=>a(u,{children:[r(T,{title:"Update User",children:r(I,{onClick:()=>$(e.row),children:r(re,{style:{color:i.greenAccent[500]}})})}),e.row.role!=="Admin"&&r(T,{title:"Promote to Admin",children:r(I,{onClick:l=>{l.stopPropagation(),H(e.row)},color:"primary",children:r(ce,{})})})]})}];return a(u,{m:"20px",children:[r(oe,{title:"TEAM",subtitle:"List of Users"}),r(b,{variant:"contained",color:"primary",sx:{mt:2,mb:2},onClick:()=>A(!0),children:"Add User"}),m.length>0&&a(b,{variant:"contained",color:"error",startIcon:r(Z,{}),onClick:_,sx:{mb:2},children:["Delete ",m.length>1?"Users":"User"]}),r(u,{height:"75vh",sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{borderBottom:"none"},"& .MuiDataGrid-columnHeaders":{backgroundColor:i.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:i.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:i.blueAccent[700]},"& .MuiCheckbox-root":{color:`${i.greenAccent[200]} !important`}},children:r(ee,{rows:B,columns:V,getRowId:e=>e._id,checkboxSelection:!0,onSelectionModelChange:e=>U(e),selectionModel:m})}),r(P,{open:!!s,onClose:()=>C(null),children:a(u,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,maxHeight:"80vh",overflowY:"auto"},children:[a(M,{variant:"h6",mb:2,children:["Update ",s==null?void 0:s.role," Profile"]}),["firstName","lastName","age","email","country"].map(e=>r(n,{label:e.charAt(0).toUpperCase()+e.slice(1),fullWidth:!0,name:e,value:t[e]||"",onChange:o,sx:{mb:2}},e)),O(),a(u,{display:"flex",justifyContent:"flex-end",mt:2,children:[r(b,{onClick:()=>C(null),variant:"outlined",sx:{mr:2},children:"Cancel"}),r(b,{onClick:G,variant:"contained",color:"primary",children:"Save Changes"})]})]})}),r(P,{open:R,onClose:()=>A(!1),children:a(u,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4},children:[r(M,{variant:"h6",mb:2,children:"Add New User"}),["firstName","lastName","age","email","country"].map(e=>r(n,{label:e.charAt(0).toUpperCase()+e.slice(1),fullWidth:!0,name:e,value:h[e]||"",onChange:w,sx:{mb:2}},e)),a(F,{fullWidth:!0,sx:{mb:2},children:[r(D,{children:"Role"}),a(W,{name:"role",value:h.role,onChange:w,label:"Role",children:[r(g,{value:"Admin",children:"Admin"}),r(g,{value:"Teacher",children:"Teacher"}),r(g,{value:"Student",children:"Student"})]})]}),r(n,{label:"Password",type:"password",fullWidth:!0,name:"password",value:h.password||"",onChange:w,sx:{mb:2}}),r(u,{display:"flex",justifyContent:"flex-end",children:r(b,{onClick:q,variant:"contained",color:"primary",children:"Add"})})]})})]})};export{ke as default};
